#!/bin/bash
# SoltrOS: Community-proven KDE Plasma Wayland suspend/resume audio fix
# Simplified version to prevent desktop freezes

case "$1" in
    post)
        # After resume - apply community-proven audio fix
        echo "SoltrOS: Applying community-proven resume audio fix"
        
        # Wait for hardware to stabilize
        sleep 3
        
        # Restart WirePlumber to fix audio devices
        for user_id in $(loginctl list-users --no-legend | awk '{print $1}');
        do
            user_name=$(id -nu "$user_id" 2>/dev/null)
            if [ -n "$user_name" ];
            then
                echo "Restarting WirePlumber for user: $user_name"
                sudo -u "$user_name" XDG_RUNTIME_DIR="/run/user/$user_id" \
                    systemctl --user restart wireplumber.service || true
            fi
        done
        
        echo "SoltrOS: Audio resume fix completed"
        ;;
    *)
        # Do nothing for other arguments like 'pre'
        ;;
esac
